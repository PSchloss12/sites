<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>JS Module Example</title>

</head>

<body>

    <p>hello world</p>

    <script type="module">

        function formatDate(date) {

            let d = new Date(date);

            let month = (d.getMonth() + 1).toString();

            let day = d.getDate().toString();

            if (month.length < 2) month = "0" + month;

            if (day.length < 2) day = "0" + day;

            return [d.getFullYear(), month, day].join("-");

        }

        function formatDate2(date) {

            let d = new Date(date);

            let month = (d.getMonth() + 1).toString();

            if (month.length < 2) month = "0" + month;

            return [d.getFullYear(), month].join("");

        }

        const params = new URLSearchParams(window.location.search);

        console.log(params);

        const dt = params.get("fd7491") ? new Date(params.get("fd7491")) : new Date();

        const day = formatDate(dt);

        const url = `https://sound.bandle.app/answers${formatDate2(dt)}.txt?d=${Date.now()}`;

        console.log(url);




        const txt = "";

        // const answers = JSON.parse(decrypt("isItReallyWorthIt", await res.text()));

        // console.log(answers);

        // const theAnswer = answers.find(x => x.day === day);

        // console.log(theAnswer);

        function crypt(salt, text) {

            if (!text) return null;

            const textToChars = (text) => text.split("").map((c) => c.charCodeAt(0));

            const byteHex = (n) => ("0" + Number(n).toString(16)).substr(-2);

            const applySaltToChar = (code) => textToChars(salt).reduce((a, b) => a ^ b, code);

            return text.split("").map(textToChars).map(applySaltToChar).map(byteHex).join("");

        }

        function decrypt(salt, encoded) {

            if (!encoded) return null;

            const textToChars = (text) => text.split("").map((c) => c.charCodeAt(0));

            const applySaltToChar = (code) => textToChars(salt).reduce((a, b) => a ^ b, code);

            return encoded.match(/.{1,2}/g).map((hex) => parseInt(hex, 16)).map(applySaltToChar)

                .map((charCode) => String.fromCharCode(charCode)).join("");

        }

        const answers = JSON.parse(decrypt("isItReallyWorthIt", txt));

        console.log(answers);

        const theAnswer = answers.find(x => x.day === day);

        console.log(theAnswer);

        console.log(theAnswer['song'])




        function detectOS() {

            const { userAgent, platform } = navigator;

            const macosPlatforms = ["Macintosh", "MacIntel", "MacPPC", "Mac68K"];

            const windowsPlatforms = ["Win32", "Win64", "Windows", "WinCE"];

            const iosPlatforms = ["iPhone", "iPad", "iPod"];

 

            if (macosPlatforms.includes(platform)) return "Mac OS";

            if (iosPlatforms.includes(platform)) return "iOS";

            if (windowsPlatforms.includes(platform)) return "Windows";

            if (/Android/.test(userAgent)) return "Android";

            if (/Linux/.test(platform)) return "Linux";

 

            return "other";

        }

    </script>

</body>